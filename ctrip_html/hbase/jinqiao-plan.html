<!DOCTYPE html>
<html>
<head>

<title>金桥Hadoop%title%amp;HBase集群切换步骤</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javascript" src="../js/jquery-1.6.4.min.js"></script>

<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shCore.css">
<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shThemeRDark.css">
<script type="text/javascript" src="../js/sh/scripts/shCore.js"></script>
<script type="text/javascript" src="../js/sh/scripts/shAutoloader.js"></script>

<script type="text/javascript" src="../js/main.js"></script>

<link rel="Stylesheet" type="text/css" href="../style.css">
<link rel="Stylesheet" type="text/css" href="../css/main.css">

</head>
<body>
	<div class="hidden">
		<input id="root_path" type="text" value="../">
	</div>
	<div id="body-wrapper">
		<div id="container">
			<div id="top">
				<div id="page-title">
					<a href="../index.html">CTRIP</a>
				</div>
				<ul id="top-nav">
				</ul>
			</div>
			<div id="middle">
				

<p>
FQ:福泉路
</p>

<p>
JQ:金桥
</p>

<ol>
<li>
创建HBase表：

<ol>
<li>
/hbase_logging

<ol>
<li>
logging所需要的表

<li>
rawlog表通过java程序创建  

</ol>
<li>
/hbase_ubt

<ol>
<li>
metrics所需要的表

<li>
自定义namespace的metrics表

</ol>
<li>
check

</ol>
<li>
停掉FQ所有的collector与writer,先停collector, 再停writer. check;

<li>
开始Copy FQ的tsdb.uid表到/hbase_ubt相就的表中

<li>
清空FQ的diskqueue目录。 check

<li>
确认FQ&amp;JQ所有的Writer都是关闭状态。

<li>
启动FQ所有的新的collector, 并确认开始收集数据。check

<li>
<strong>以上五步，需要一台一台处理 </strong>

<li>
更新Mysql中HBase的配置，确保metrics写入 jQ的hbase实例/hbase_ubt

<li>
重新部署LogBrowser与RestApi, 验证是否正常工作

<li>
停止LogViewer服务，增加指导性信息。

<li>
更新TraceViewer的查询地址到JQ,并重启。

<li>
dashboard 查询端指向JQ的hbase实例/hbase_ubt.需要江伟配合

<li>
等待并确认tsdb.uid表同步完

<li>
启动JQ的一台writer.

<li>
运行测试程序，查看log metrics span的写入情况是否正常

<li>
启动FQ&amp;JQ所有的writer.

<li>
查看集群工作状态。

</ol>

<p>
后续：
</p>
<ol>
<li>
同步FQ的metrics老数据到JQ的/hbase_ubt

<li>
同步FQ的trace老数据到JQ的/hbase_logging

</ol>

<p>
出错回滚：
</p>
<ol>
<li>
停掉新部署的collector

<li>
启动老的FQ collector和wrtier

</ol>

			</div>

			<div id="bottom">
				&copy; 2012 王兴朝
			</div>
		</div>
	<div>
</body>
</html>

<!DOCTYPE html>
<html>
<head>

<title>Hive Ad Hoc Log Query</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javascript" src="../js/jquery-1.6.4.min.js"></script>

<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shCore.css">
<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shThemeRDark.css">
<script type="text/javascript" src="../js/sh/scripts/shCore.js"></script>
<script type="text/javascript" src="../js/sh/scripts/shAutoloader.js"></script>

<script type="text/javascript" src="../js/main.js"></script>

<link rel="Stylesheet" type="text/css" href="../style.css">
<link rel="Stylesheet" type="text/css" href="../css/main.css">

</head>
<body>
	<div class="hidden">
		<input id="root_path" type="text" value="../">
	</div>
	<div id="body-wrapper">
		<div id="container">
			<div id="top">
				<div id="page-title">
					<a href="../index.html">CTRIP</a>
				</div>
				<ul id="top-nav">
				</ul>
			</div>
			<div id="middle">
				

<h1 id="toc_1"> Hive Ad Hoc Log Query</h1>

<div class="toc">
<ul>
<li><a href="#toc_1"> Hive Ad Hoc Log Query</a>
<ul>
<li><a href="#toc_1.1">1 概述</a>
<li><a href="#toc_1.2">2 设计目标</a>
<li><a href="#toc_1.3">3 总体架构</a>
<li><a href="#toc_1.4">4 组件组成</a>
<ul>
<li><a href="#toc_1.4.1">4.1 Domain对象</a>
<li><a href="#toc_1.4.2">4.2 RestApi</a>
<li><a href="#toc_1.4.3">4.3 执行Job</a>
</ul>
</ul>
</ul>
</div>

<h2 id="toc_1.1">1 概述</h2>

<p>
目前用户除了通过LogBrowser查询最近7天的日志数据外，没有一种好的方式查询7天以前的数据。
</p>

<p>
现在是用户提出需求，我们手动执行查询，然后告诉用户下载链接。这种方式不通用，而且双方都不方便，占用大量人工成本，无法应付大量需求。
</p>

<p>
需要提供一种类似自动化流程，用户自己操作的方式提供支持复杂条件的日志导出。
</p>

<h2 id="toc_1.2">2 设计目标</h2>
<ol>
<li>
基于Hive提供支持复杂条件的日志查询服务

<li>
查询结果存储为CSV文件

<li>
用户自己操作

</ol>

<h2 id="toc_1.3">3 总体架构</h2>
<p>
下面是包含的组件与查询流程：
</p>

<p>
<img src="hiveadhoclogquery.png" />
</p>

<p>
工作流程：
</p>
<ol>
<li>
<strong>提交一个日志查询需求 </strong>

<ul>
<li>
可以通过RestApi直接提交

<li>
也可以通过LogBrowser中的一个页面，间接通过RestApi提交

<li>
需要根据要求填写查询条件

</ul>
<li>
<strong>执行一个查询需求 </strong>

<ul>
<li>
从队列中取出下一个查询需求

<li>
根据需求组装成一个hive查询语句

<li>
执行这个查询语句(实际上是一个mapreduce job)

<li>
查询结果根据规约放到指定的地方

</ul>
<li>
<strong>发送查询结果邮件 </strong>

<ul>
<li>
一个查询需求执行完毕后，给指定的用户发送查询结果邮件

<li>
邮件中内嵌查询结果的下载链接

</ul>
<li>
<strong>下载查询结果</strong>

<ul>
<li>
用户收到查询结果邮件后，通过邮件中的链接下载查询结果

</ul>
</ol>
  

<h2 id="toc_1.4">4 组件组成</h2>

<h3 id="toc_1.4.1">4.1 Domain对象</h3>

<h3 id="toc_1.4.2">4.2 RestApi</h3>

<h3 id="toc_1.4.3">4.3 执行Job</h3>

			</div>

			<div id="bottom">
				&copy; 2012 王兴朝
			</div>
		</div>
	<div>
</body>
</html>

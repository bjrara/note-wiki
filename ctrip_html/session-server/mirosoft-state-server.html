<!DOCTYPE html>
<html>
<head>

<title>Microsoft-State-Server </title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javascript" src="../js/jquery-1.6.4.min.js"></script>

<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shCore.css">
<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shThemeRDark.css">
<script type="text/javascript" src="../js/sh/scripts/shCore.js"></script>
<script type="text/javascript" src="../js/sh/scripts/shAutoloader.js"></script>

<script type="text/javascript" src="../js/main.js"></script>

<link rel="Stylesheet" type="text/css" href="../style.css">
<link rel="Stylesheet" type="text/css" href="../css/main.css">

</head>
<body>
	<div class="hidden">
		<input id="root_path" type="text" value="../">
	</div>
	<div id="body-wrapper">
		<div id="container">
			<div id="top">
				<div id="page-title">
					<a href="../index.html">CTRIP</a>
				</div>
				<ul id="top-nav">
				</ul>
			</div>
			<div id="middle">
				

<h1 id="toc_1"> Microsoft State Server</h1>

<h2 id="toc_1.1">1 用到的field和http header</h2>

<h3 id="toc_1.1.1">1.1 关键字段</h3>

<p>
<strong>unique-identifier</strong> = <strong>application-identifier</strong> <strong>appdomain-identifier</strong> <em>delimiter</em> <strong>session-identifier</strong>
</p>

<h3 id="toc_1.1.2">1.2 Http Header</h3>
<table>
<tr>
<th>
&nbsp;
</th>
<th>
Value
</th>
<th>
Request
</th>
<th>
Response
</th>
<th>
&nbsp;
</th>
</tr>
<tr>
<td>
X-AspNet-Version
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
yes
</td>
<td>
在response的返回中，用于指定asp.net的版本 
</td>
</tr>
<tr>
<td>
Timeout
</td>
<td>
default:20
</td>
<td>
yes
</td>
<td>
yes
</td>
<td>
单位：minute
</td>
</tr>
<tr>
<td>
Exclusive
</td>
<td>
&nbsp;
</td>
<td>
yes
</td>
<td>
&nbsp;
</td>
<td>
client用于获取或释放锁
</td>
</tr>
<tr>
<td>
LockDate
</td>
<td>
64-bit
</td>
<td>
?
</td>
<td>
yes
</td>
<td>
单位是100ns. since midnight, January 1, 0001 C.E.
</td>
</tr>
<tr>
<td>
LockCookie
</td>
<td>
32-bit
</td>
<td>
yes
</td>
<td>
yes
</td>
<td>
谁来创建？ 
</td>
</tr>
<tr>
<td>
LockAge
</td>
<td>
64-bit
</td>
<td>
?
</td>
<td>
yes
</td>
<td>
单位是second.
</td>
</tr>
<tr>
<td>
ExtraFlags
</td>
<td>
&nbsp;
</td>
<td>
yes
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
ActionFlags
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
yes
</td>
<td>
&nbsp;
</td>
</tr>
</table>

<h2 id="toc_1.2">2 ResponseCode</h2>

<table>
<tr>
<th>
&nbsp;
</th>
<th>
Client Reaction
</th>
</tr>
<tr>
<td>
200 OK
</td>
<td>
每种方法后的后续操作不一样 
</td>
</tr>
<tr>
<td>
400 Bad Request
</td>
<td>
向上层丢出某种error
</td>
</tr>
<tr>
<td>
404 Not Found
</td>
<td>
向上层丢出某种error
</td>
</tr>
<tr>
<td>
423 Locked
</td>
<td>
客户端根据lock-cookie, lock-age, lock-date，进行相应处理 
</td>
</tr>
</table>

<h2 id="toc_1.3">3 Method</h2>
<table>
<tr>
<th>
&nbsp;
</th>
<th>
Client
</th>
<th>
Server
</th>
<th>
&nbsp;
</th>
<th>
&nbsp;
</th>
</tr>
<tr>
<td>
Get
</td>
<td>
response中存在actionflags=1,执行初始化工作，但引起的session data的更改，不充许发回server
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
GetExclusive
</td>
<td>
response中存在actionflags=1,执行初始化工作，引起的session data的更改，可以通过set发回server
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td rowspan="2">
Set
</td>
<td>
第一次设置，client需要生成一个LockCookie,但Server忽略该值 
</td>
<td>
不存在，且request设置了ExtralFlags,存储该标记，response需要设置相应的ActionFlags
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
需不需要锁?
</td>
<td>
存在，且request设置了ExtralFlags=1,返回现有的data
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
ReleaseExclusive
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
Remove
</td>
<td>
只有在获取锁(真正的，不是仅仅知道lock cookie)的情况下，发送该请求
</td>
<td>
需要验证锁
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
ResetTimeout
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
</table>

			</div>

			<div id="bottom">
				&copy; 2012 王兴朝
			</div>
		</div>
	<div>
</body>
</html>

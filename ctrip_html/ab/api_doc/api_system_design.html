<!DOCTYPE html>
<html>
<head>

<title> AB Test Framework Restful API服务端设计 </title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javascript" src="../../js/jquery-1.6.4.min.js"></script>

<link rel="Stylesheet" type="text/css" href="../../js/sh/styles/shCore.css">
<link rel="Stylesheet" type="text/css" href="../../js/sh/styles/shThemeRDark.css">
<script type="text/javascript" src="../../js/sh/scripts/shCore.js"></script>
<script type="text/javascript" src="../../js/sh/scripts/shAutoloader.js"></script>

<script type="text/javascript" src="../../js/main.js"></script>

<link rel="Stylesheet" type="text/css" href="../../style.css">
<link rel="Stylesheet" type="text/css" href="../../css/main.css">

</head>
<body>
	<div class="hidden">
		<input id="root_path" type="text" value="../../">
	</div>
	<div id="body-wrapper">
		<div id="container">
			<div id="top">
				<div id="page-title">
					<a href="../../index.html">CTRIP</a>
				</div>
				<ul id="top-nav">
				</ul>
			</div>
			<div id="middle">
				

<h1 id="toc_1">AB Test Framework Restful API服务端设计 </h1>

<div class="toc">
<ul>
<li><a href="#toc_1">AB Test Framework Restful API服务端设计 </a>
<ul>
<li><a href="#toc_1.1">AB Test Framework Big Picture</a>
<li><a href="#toc_1.2">API服务端功能 </a>
<li><a href="#toc_1.3">数据模型</a>
<li><a href="#toc_1.4">域模型 </a>
<li><a href="#toc_1.5">域模型的关系</a>
<li><a href="#toc_1.6">实现架构</a>
<li><a href="#toc_1.7">RESTFul Http资源 与 Domain实体</a>
<li><a href="#toc_1.8">预定义API</a>
<li><a href="#toc_1.9">附录：一个 <code>Experiment</code> 实例</a>
<ul>
<li><a href="#toc_1.9.1">Experiment的XML实例</a>
<li><a href="#toc_1.9.2">Experiment的JSON实例</a>
</ul>
</ul>
</ul>
</div>

<h2 id="toc_1.1">AB Test Framework Big Picture</h2>
<p>
<img src="ab_big.png" />
</p>
<ul>
<li>
<b>RESTFul Service:</b> 提供数据服务

<li>
<b>Admin console 管理系统:</b> 通过 <code>restful api service</code> 添加管理无数据 

<li>
<b>Client Library:</b> 提供相应的client library 供app使用

<li>
<b>Reporter 报表系统:</b> 从其他系统（比如日志系统）提出相关数据结合自身收集的数据做数据分析，得出报表，提供给相关部门。

</ul>

<h2 id="toc_1.2">API服务端功能 </h2>
<ol>
<li>
 提供 <code>AB Test Framework</code> 相关元数据的存储

<li>
 开放一套 <code>Restful风格的Api</code> , 向外提供 <code>AB Test Framework</code> 数据服务

<li>
供管理后台添加管理元数据

<li>
供 <code>Client Library</code> 请求数据

<li>
供 <code>Reporter</code> 抽取数据

</ol>

<h2 id="toc_1.3">数据模型</h2>
<p>
<img src="ab_test.png" />
</p>

<h2 id="toc_1.4">域模型 </h2>
<ul>
<li>
<em><strong>Experiment:</strong></em>   代表一个AB测试实例

<li>
<em><strong>RuleType:</strong></em>   分流规则，一个AB测试实例选择一种分流规则

<li>
<em><strong>Alternative:</strong></em>   代表一个AB测试实例的一个方案

<li>
<em><strong>RuleParams:</strong></em>   代表一个方案的分流参数

</ul>
<h2 id="toc_1.5">域模型的关系</h2>
<ol>
<li>
一个 <code>Experiment</code> 可以包含多个 <code>Alternative</code>

<li>
一个 <code>Experiment</code> 指定一个 <code>RuleType</code>

<li>
为每一个 <code>Alternative</code> 配置一个 <code>RuleParams</code>

<li>
根据 <code>Experiment</code> 上的 <em><strong>RuleType</strong></em> 和 <code>Alternative</code>上的 <em><strong>RuleParams</strong></em> 就可以计算每一个 <code>Alternative</code> 的分配规则

</ol>

<h2 id="toc_1.6">实现架构</h2>
<p>
<img src="ab_archetecture.png" />
</p>

<ul>
<li>
<em><strong>Spring:</strong></em>  提供统一的对象管理 

<li>
<em><strong>DB:</strong></em> 存储数据 

<li>
<em><strong>Domain Entities:</strong></em> 数据模型 

<li>
<em><strong>MyBatis:</strong></em> ORM框架，实现数据访问与映射 

<li>
<em><strong>Logic Service:</strong></em> 业务逻辑 

<li>
<em><strong>Jersey:</strong></em> Restful风格的web框架， 用于实现rest语义. 

<li>
<em><strong>WebResource:</strong></em> Rest中的resource 

</ul>

<h2 id="toc_1.7">RESTFul Http资源 与 Domain实体</h2>
<p>
<img src="ab_resource_entity.png" />
</p>

<h2 id="toc_1.8">预定义API</h2>
<table>
<tr>
<th>
URL
</th>
<th>
Method
</th>
<th>
Request
</th>
<th>
Response
</th>
<th>
&nbsp;
</th>
</tr>
<tr>
<td rowspan="2">
<em><strong>/ab/experiments</strong></em>
</td>
<td>
GET
</td>
<td>
无 
</td>
<td>
XML,JSON
</td>
<td>
获得<code>Experment</code>列表
</td>
</tr>
<tr>
<td>
POST
</td>
<td>
XML,JSON,FORM
</td>
<td>
text/plain
</td>
<td>
创建一个新<code>Experment</code>, 返回创建的资源地址
</td>
</tr>
<tr>
<td rowspan="3">
<em><strong>/ab/experiments</strong></em>/<strong>{elementId}</strong>
</td>
<td>
GET
</td>
<td>
无 
</td>
<td>
XML,JSON
</td>
<td>
获得指定的 <code>Experiment</code>
</td>
</tr>
<tr>
<td>
POST
</td>
<td>
FORM
</td>
<td>
无 
</td>
<td>
更该指定<code>Experment</code>的部分信息 
</td>
</tr>
<tr>
<td>
PUT
</td>
<td>
XML，JSON
</td>
<td>
无 
</td>
<td>
更新指定<code>Experment</code>
</td>
</tr>
<tr>
<td rowspan="2">
<em><strong>/ab/experiments</strong></em>/<strong>{elementId}</strong><em><strong>/alternatives</strong></em>
</td>
<td>
GET
</td>
<td>
无 
</td>
<td>
XML,JSON
</td>
<td>
获得指定的 <code>Experiment</code> 的所有 <code>Alternative</code>
</td>
</tr>
<tr>
<td>
POST
</td>
<td>
XML,JSON,FROM
</td>
<td>
text/plain
</td>
<td>
为指定的<code>Experment</code>创建一个新 <code>Alternative</code>
</td>
</tr>
<tr>
<td rowspan="3">
<em><strong>/ab/experiments</strong></em>/<strong>{elementId}</strong><em><strong>/alternatives</strong></em>/<strong>{alternativeId}</strong>
</td>
<td>
GET
</td>
<td>
无 
</td>
<td>
XML,JSON
</td>
<td>
获得指定的 <code>Experiment</code> 的一个指定的 <code>Alternative</code>
</td>
</tr>
<tr>
<td>
POST
</td>
<td>
FORM
</td>
<td>
无 
</td>
<td>
修改一个指定的 <code>Alternative</code>
</td>
</tr>
<tr>
<td>
PUT
</td>
<td>
XML,JSON
</td>
<td>
无 
</td>
<td>
更新一个指定的 <code>Alternative</code>
</td>
</tr>
<tr>
<td rowspan="3">
<em><strong>/ab/experiments</strong></em>/<strong>{elementId}</strong><em><strong>/alternatives</strong></em>/<strong>{alternativeId}</strong><em><strong>/rule-params</strong></em>
</td>
<td>
GET
</td>
<td>
无 
</td>
<td>
XML,JSON
</td>
<td>
获得一个指定的 <code>Alternative</code> 的 <code>RuleParams</code>
</td>
</tr>
<tr>
<td>
POST
</td>
<td>
FORM
</td>
<td>
无 
</td>
<td>
修改一个指定的 <code>Alternative</code> 的 <code>RuleParams</code>
</td>
</tr>
<tr>
<td>
PUT
</td>
<td>
XML,JSON
</td>
<td>
无 
</td>
<td>
修改一个指定的 <code>Alternative</code> 的 <code>RuleParams</code>
</td>
</tr>
<tr>
<td rowspan="2">
<em><strong>/ab/rule-types</strong></em>
</td>
<td>
GET
</td>
<td>
无 
</td>
<td>
XML,JSON
</td>
<td>
获得 <code>RuleType</code> 列表
</td>
</tr>
<tr>
<td>
POST
</td>
<td>
XML,JSON,FORM
</td>
<td>
text/plain
</td>
<td>
新增一个新的 <code>RuleType</code> , 返回创建的资源地址
</td>
</tr>
<tr>
<td rowspan="3">
<em><strong>/ab/rule-types</strong></em>/<strong>{ruleTypeId}</strong>
</td>
<td>
GET
</td>
<td>
无 
</td>
<td>
XML,JSON
</td>
<td>
获得指定的 <code>RuleType</code>
</td>
</tr>
<tr>
<td>
POST
</td>
<td>
FORM
</td>
<td>
无 
</td>
<td>
更该指定 <code>RuleType</code> 的部分信息 
</td>
</tr>
<tr>
<td>
PUT
</td>
<td>
XML，JSON
</td>
<td>
无 
</td>
<td>
更新指定 <code>RuleType</code>
</td>
</tr>
</table>
 
<h2 id="toc_1.9">附录：一个 <code>Experiment</code> 实例</h2>

<h3 id="toc_1.9.1">Experiment的XML实例</h3>
<pre  class="brush:xml">
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
    &lt;experiment&gt;
        &lt;url&gt;http://localhost:8080/ab-service/experiments/2&lt;/url&gt;
        &lt;name&gt;Test One&lt;/name&gt;
        &lt;description&gt;Test One&lt;/description&gt;
        &lt;startDate&gt;2012-11-01 00:00&lt;/startDate&gt;
        &lt;endDate&gt;2012-12-31 00:00&lt;/endDate&gt;
        &lt;isActive&gt;true&lt;/isActive&gt;
        &lt;ruleType&gt;
            &lt;url&gt;http://localhost:8080/ab-service/rule-types/1&lt;/url&gt;
            &lt;code&gt;PERCENT&lt;/code&gt;
            &lt;description&gt;group the user by percent.&lt;/description&gt;
        &lt;/ruleType&gt;
        &lt;alternatives&gt;
            &lt;alternative&gt;
                &lt;url&gt;http://localhost:8080/ab-service/experiments/2/alternatives/7&lt;/url&gt;
                &lt;code&gt;A_A&lt;/code&gt;
                &lt;name&gt;Alternative a&lt;/name&gt;
                &lt;description&gt;test alternative a&lt;/description&gt;
                &lt;isActive&gt;true&lt;/isActive&gt;
                &lt;ruleParams&gt;
                    &lt;url&gt;http://localhost:8080/ab-service/experiments/2/alternatives/7/rule-params&lt;/url&gt;
                    &lt;param1&gt;30&lt;/param1&gt;
                &lt;/ruleParams&gt;
            &lt;/alternative&gt;
            &lt;alternative&gt;
                &lt;url&gt;http://localhost:8080/ab-service/experiments/2/alternatives/8&lt;/url&gt;
                &lt;code&gt;A_B&lt;/code&gt;
                &lt;name&gt;Alternative b&lt;/name&gt;
                &lt;description&gt;test alternative b&lt;/description&gt;
                &lt;isActive&gt;true&lt;/isActive&gt;
                &lt;ruleParams&gt;
                    &lt;url&gt;http://localhost:8080/ab-service/experiments/2/alternatives/8/rule-params&lt;/url&gt;
                    &lt;param1&gt;30&lt;/param1&gt;
                &lt;/ruleParams&gt;
            &lt;/alternative&gt;
        &lt;/alternatives&gt;
    &lt;/experiment&gt;
</pre>
  
<h3 id="toc_1.9.2">Experiment的JSON实例</h3>
<pre  class="brush:js">

    {
        "url": "http://localhost:8080/ab-service/experiments/2",
        "name": "Test one",
        "description": "Test one",
        "startDate": "2012-11-01 00:00",
        "endDate": "2012-12-31 00:00",
        "isActive": true,
        "ruleType": {
            "url": "http://localhost:8080/ab-service/rule-types/1",
            "code": "PERCENT",
            "description": "group the user by percent."
        },
        "alternatives": [
            {
                "code": "A_A",
                "url": "http://localhost:8080/ab-service/experiments/2/alternatives/7",
                "name": "Alternative a",
                "description": "test alternative description a",
                "isActive": true,
                "ruleParams": {
                    "url": "http://localhost:8080/ab-service/experiments/2/alternatives/7/rule-params",
                    "param1": "30",
                    "param2": null,
                    "param3": null,
                    "param4": null,
                    "param5": null,
                    "param6": null,
                    "param7": null,
                    "param8": null,
                    "param9": null
                }
            },
            {
                "code": "A_B",
                "url": "http://localhost:8080/ab-service/experiments/2/alternatives/7",
                "name": "Alternative b",
                "description": "test alternative description b",
                "isActive": true,
                "ruleParams": {
                    "url": "http://localhost:8080/ab-service/experiments/2/alternatives/7/rule-params",
                    "param1": "30",
                    "param2": null,
                    "param3": null,
                    "param4": null,
                    "param5": null,
                    "param6": null,
                    "param7": null,
                    "param8": null,
                    "param9": null
                }
            }
        ]
    }
</pre>

			</div>

			<div id="bottom">
				&copy; 2012 王兴朝
			</div>
		</div>
	<div>
</body>
</html>

%title Microsoft-State-Server 

=Microsoft State Server =

==用到的field和http header==

===关键字段===

*unique-identifier* = *application-identifier* *appdomain-identifier* _delimiter_ *session-identifier*

===Http Header===
|                  | Value      | Request | Response |                                                   |
|------------------|------------|---------|----------|---------------------------------------------------|
| X-AspNet-Version |            |         | yes      | 在response的返回中，用于指定asp.net的版本         |
| Timeout          | default:20 | yes     | yes      | 单位：minute                                      |
| Exclusive        |            | yes     |          | client用于获取或释放锁                            |
| LockDate         | 64-bit     | ?       | yes      | 单位是100ns. since midnight, January 1, 0001 C.E. |
| LockCookie       | 32-bit     | yes     | yes      | 谁来创建？                                        |
| LockAge          | 64-bit     | ?       | yes      | 单位是second.                                     |
| ExtraFlags       |            | yes     |          |                                                   |
| ActionFlags      |            |         | yes      |                                                   |

==ResponseCode==

|                 | Client Reaction                                          |
|-----------------|----------------------------------------------------------|
| 200 OK          | 每种方法后的后续操作不一样                               |
| 400 Bad Request | 向上层丢出某种error                                      |
| 404 Not Found   | 向上层丢出某种error                                      |
| 423 Locked      | 客户端根据lock-cookie, lock-age, lock-date，进行相应处理 |

==Method==
|                  | Client                                                                                      | Server                                                                           |   |   |
|------------------|---------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|---|---|
| Get              | response中存在actionflags=1,执行初始化工作，但引起的session data的更改，不充许发回server    |                                                                                  |   |   |
| GetExclusive     | response中存在actionflags=1,执行初始化工作，引起的session data的更改，可以通过set发回server |                                                                                  |   |   |
| Set              | 第一次设置，client需要生成一个LockCookie,但Server忽略该值                                   | 不存在，且request设置了ExtralFlags,存储该标记，response需要设置相应的ActionFlags |   |   |
| \/               | 需不需要锁?                                                                                 | 存在，且request设置了ExtralFlags=1,返回现有的data                                |   |   |
| ReleaseExclusive |                                                                                             |                                                                                  |   |   |
| Remove           | 只有在获取锁(真正的，不是仅仅知道lock cookie)的情况下，发送该请求                           | 需要验证锁                                                                       |   |   |
| ResetTimeout     |                                                                                             |                                                                                  |   |   |

